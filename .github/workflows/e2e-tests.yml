# .github/workflows/e2e-tests.yml

name: E2E COA Validation Test
on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm ci

      - name: Install Playwright Browsers
        run: npx playwright install --with-deps

      # =================================================================
      # [추가된 디버깅 단계]
      # Playwright 테스트 실행 전에 환경 변수가 제대로 설정되었는지 확인합니다.
      # =================================================================
      - name: Debug Environment Variables
        run: |
          if [ -z "$ADEKA_ID" ]; then
            echo "::error::ADEKA_ID 환경 변수가 설정되지 않았습니다!"
          else
            echo "::notice::ADEKA_ID 환경 변수가 성공적으로 설정되었습니다."
          fi
          
          if [ -z "$ADEKA_PASSWORD" ]; then
            echo "::error::ADEKA_PASSWORD 환경 변수가 설정되지 않았습니다!"
          else
            echo "::notice::ADEKA_PASSWORD 환경 변수가 성공적으로 설정되었습니다."
          fi

      - name: Run Playwright tests
        run: npx playwright test
        env:
          ADEKA_ID: ${{ secrets.ADEKA_ID }}
          ADEKA_PASSWORD: ${{ secrets.ADEKA_PASSWORD }}
          BASE_URL: 'https://spc.adkk.co.kr:8091'
          CI: true

      - name: Upload test report
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: playwright-report
          path: playwright-report/
          retention-days: 30
